# Antigravity Coaching System

## System Configuration
The system behavior is controlled by `src/config.ts`.
- **SYSTEM_MODE**: Controls the source of content generation.
    - `DETERMINISTIC` (Default): Content is static/mocked. Used for structural verification.
    - `INTELLIGENT`: Content is generated by AI/LLM. Not yet active.

**Important**: Changing `SYSTEM_MODE` does NOT change the structural pipeline logic (`Sargas` -> `Treneris` -> `Session`). It only affects the *Content Fields* of the output.

## Content Layer
The `src/content/` directory contains the interface for content generation.
- **Goal**: Separate *what* happens (Structure) from *how it is described* (Content).
- **Files**: `src/content/descriptions.ts`
- **Current State**: Returns static strings. Prepared for future LLM integration.

## System Modes

### Current Mode: Deterministic
The system is currently operating in **Structure Verification Mode**. 
- **Intelligence**: INACTIVE
- **Logic**: Hardcoded rules and static return values.
- **Pipeline**: Linear execution (Sargas -> Treneris -> Session).
- **Purpose**: To validate the structural integrity of data flow and type contracts.

### Moving to Intelligent Mode
To enable intelligent behaviors, the following requirements must be met:
1.  **Behavior Layer Activation**: The logic in `src/behavior/` must be implemented and wired.
2.  **LLM Integration**: Agents must be connected to an inference engine (e.g., Gemini).
3.  **Context Loading**: Dynamic user history and context must replace static inputs.
4.  **Non-Linear Flow**: The Master Agent must be upgraded to handle dynamic decision branching.

## Output Contract

The system enforces a strict separation between structural fields and content fields. Intelligent agents may ONLY modify Content Fields.

### Structural Fields (IMMUTABLE via Intelligence)
These fields determine system flow and cannot be hallucinated or fuzzily generated.
- `SargasOutput.color` ('RED' | 'YELLOW' | 'GREEN')
- `SargasOutput.canTrain` (boolean)
- `SessionBlock.durationMin` (number - constrained by logic)
- `SessionBlock.intensity` ('LOW' | 'MEDIUM' | 'HIGH')

### Content Fields (MUTABLE via Intelligence)
These fields are descriptive and can be enhanced by LLM reasoning.
- `SargasOutput.reason` (Explanation text)
- `TrenerisOutput.situationAnalysis` (Deep reasoning text)
- `TrenerisOutput.rationale` (Why this path was chosen)
- `TrenerisOutput.directions` (Specific coaching cues)
- `SessionBlock.description` (Drill details and cues)
- `SessionOutput.mainFocus` (Thematic description)

## INTELLIGENCE WRITE BOUNDARY
The distinction between logic and intelligence is not just a convention; it is enforced by strict type interfaces in `src/content/descriptions.ts`.

### Modifiable by Intelligent Mode
- Explanation strings
- Reasoning text
- Descriptive labels
- Content-rich analysis

### IMMUTABLE by Intelligent Mode
- Pipeline Execution Order (`Sargas -> Treneris -> Session`)
- Control Flow Conditions (Boolean checks, numeric thresholds)
- Safety Flags (`color`, `canTrain`)
- Structural Limits (`durationMin`)

Violations of this boundary will result in **compile-time errors**. Intelligence cannot redefine system behavior.

## Intelligence Injection Boundary

This system implements a strict **Intelligence Injection Layer** (`src/content/injection.ts`) to manage how AI/LLM capabilities interact with the core application.

### Where Intelligence is ALLOWED
-   **Content Generation**: Producing descriptive text, analysis, and reasoning explanation.
-   **File Scope**: Strictly limited to `src/content/descriptions.ts` via the `IntelligenceLayer`.
-   **Output Types**: Must strictly conform to the `NarrativeOutput` interface (Strings only).

### Where Intelligence is FORBIDDEN
-   **Execution Pipeline**: Intelligence cannot alter the order of operations.
-   **Control Logic**: Intelligence cannot modify flags, booleans, or state enums.
-   **Timing**: Intelligence cannot delay or re-schedule pipeline events.
-   **Configuration**: Intelligence cannot access or modify `SYSTEM_CONFIG`.

### Preservation of Determinism
The Injection Layer is designed to be **Transparent**. 
-   If `SYSTEM_CONFIG.MODE === 'DETERMINISTIC'`, the injection layer completely deactivates. 
-   The core logic pipeline (`Sargas` -> `Treneris` -> `Session`) is unaware of the injection layer's existence; it simply consumes content strings that may or may not have been enhanced.

## BASELINE LOCK
- **Status**: FROZEN
- **PipelineType**: Deterministic / Structure Verification
- **Input Source**: 
    - In `DETERMINISTIC` mode: Ignores external input by design; uses internal static mock.
    - In `INTELLIGENT` mode: Requires explicit external input.
- **Reference**: This version (v0.1.0-structure-lock) serves as the immutable structural baseline.
- **Constraints**:
  - Future AI/Intelligence layers MUST NOT modify `src/agents/pipeline.ts`.
  - Intelligence implementation is restricted to `src/content/` (Generators) or `src/behavior/` (New Layers).
  - The core execution flow `Sargas -> Treneris -> Session` is structurally locked.

## Mode Transition Rules
- **DETERMINISTIC** is the default, verification-safe mode. It MUST be used for all structural validation.
- **INTELLIGENT** mode MUST NEVER be enabled silently, temporarily, or without a backend.
- Switching modes is a significant architectural event, not a runtime flag flip.

## EVOLUTION CONTRACT
This system is designed for **Additive Evolution**. 

### Freely Evolving Areas
- `src/content/**`: Descriptions, explanations, and LLM prompts.
- `src/behavior/**`: New behavior modules, plugins, or extensions.
- `src/components/**`: UI components and styles.

### Frozen Core (STRUCTURAL LOCK)
- `src/agents/pipeline.ts`: The Execution Pipeline.
- `src/types/index.ts`: The Core Contracts (Structural Types).
- `src/agents/*Agent.ts`: The Core Agent Logic (Conditions and Returns).

**Violation**: Any attempt to modify the Frozen Core to accommodate intelligence features is a violation of the system architecture. Intelligence must fit WITHIN the content boundary, or EXTEND the system via the Behavior Layer.

## FAILURE MODE PROTOCOL
System behavior in the event of Intelligence/LLM failure:

1. **NO Fallback**: The system does NOT revert to deterministic logic if intelligent generation fails.
2. **NO Retries**: The system does NOT attempt to re-query the provider automatically.
3. **NO Auto-Repair**: The system does NOT attempt to "guess" missing content.
4. **Explicit Failure**: The system WILL halt or error explicitly (throw/crash) if the Content Layer fails to return valid `Content` types.

**Why?**
Hiding intelligent failure behind deterministic fallbacks creates "zombie" states where the user believes the system is thinking, but it is actually just reciting scripts. Explicit failure is preferred over deceptive stability.
